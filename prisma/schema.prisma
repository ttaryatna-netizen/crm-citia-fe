generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String      @id @default(cuid())
  name       String
  email      String      @unique
  role       String      @default("engineer")
  phone      String?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  activities Activity[]
  projects   Project[]
  workOrders WorkOrder[]
}

model Client {
  id        String      @id @default(cuid())
  name      String
  email     String?
  phone     String?
  company   String
  address   String?
  industry  String?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  equipment Equipment[]
  projects  Project[]
}

model Equipment {
  id           String      @id @default(cuid())
  clientId     String
  name         String
  type         String
  model        String?
  serialNumber String?     @unique
  location     String?
  status       String      @default("operational")
  lastService  DateTime?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  client       Client      @relation(fields: [clientId], references: [id])
  workOrders   WorkOrder[]
}

model Project {
  id          String      @id @default(cuid())
  projectCode String      @unique
  clientId    String
  engineerId  String
  title       String
  description String?
  type        String
  status      String      @default("planning")
  priority    String      @default("medium")
  startDate   DateTime
  endDate     DateTime?
  budget      Decimal?    @db.Decimal(12, 2)
  actualCost  Decimal?    @db.Decimal(12, 2)
  location    String?
  notes       String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  activities  Activity[]
  client      Client      @relation(fields: [clientId], references: [id])
  engineer    User        @relation(fields: [engineerId], references: [id])
  workOrders  WorkOrder[]
}

model WorkOrder {
  id          String     @id @default(cuid())
  woNumber    String     @unique
  projectId   String?
  equipmentId String?
  engineerId  String
  title       String
  description String?
  type        String
  status      String     @default("open")
  priority    String     @default("medium")
  scheduledAt DateTime?
  completedAt DateTime?
  hours       Decimal?   @db.Decimal(5, 2)
  notes       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  activities  Activity[]
  materials   Material[]
  engineer    User       @relation(fields: [engineerId], references: [id])
  equipment   Equipment? @relation(fields: [equipmentId], references: [id])
  project     Project?   @relation(fields: [projectId], references: [id])
}

model Material {
  id          String    @id @default(cuid())
  workOrderId String
  name        String
  quantity    Decimal   @db.Decimal(10, 2)
  unit        String
  unitPrice   Decimal?  @db.Decimal(10, 2)
  totalPrice  Decimal?  @db.Decimal(12, 2)
  notes       String?
  workOrder   WorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Cascade)
}

model Activity {
  id           String     @id @default(cuid())
  projectId    String?
  workOrderId  String?
  userId       String
  title        String
  description  String?
  activityDate DateTime   @default(now())
  duration     Decimal?   @db.Decimal(5, 2)
  createdAt    DateTime   @default(now())
  project      Project?   @relation(fields: [projectId], references: [id])
  user         User       @relation(fields: [userId], references: [id])
  workOrder    WorkOrder? @relation(fields: [workOrderId], references: [id])
}
